<ion-modal [isOpen]="isModalOpen" (didDismiss)="closeModal()" (willPresent)="onModalWillPresent()">
  <ng-template>
    <div class="min-h-screen bg-gradient-to-br from-black/60 via-purple-900/30 to-blue-900/40 dark:from-black/70 dark:via-purple-900/40 dark:to-blue-900/50 backdrop-blur-sm flex items-center justify-center p-4 overflow-y-auto">
      <div
        class="bg-gradient-to-br from-white/95 via-white/90 to-white/85 dark:from-slate-800/95 dark:via-slate-800/90 dark:to-slate-800/85 rounded-3xl shadow-2xl w-full max-w-md mx-auto my-4 overflow-hidden transform transition-all duration-300 scale-95 animate-in fade-in-90 zoom-in-90 max-h-[calc(100vh-2rem)] border border-white/30 dark:border-slate-700/30 backdrop-blur-md">

        <!-- Modal Header with Enhanced Gradient -->
        <div class="bg-gradient-to-r from-blue-500 via-indigo-600 to-purple-600 p-6 relative overflow-hidden">
          <!-- Animated gradient overlay -->
          <div class="absolute inset-0 bg-gradient-to-r from-white/10 via-white/5 to-white/10 transform rotate-12 scale-150"></div>
          <h3 class="text-xl font-bold text-white flex items-center gap-3 relative z-10 drop-shadow-lg">
            <div class="w-8 h-8 bg-white/20 rounded-lg flex items-center justify-center backdrop-blur-sm">
              <ion-icon name="book" class="text-lg text-white"></ion-icon>
            </div>
            {{ editingHomework ? 'Edit Homework' : 'Add Homework' }}
          </h3>
          <!-- Subtle pattern overlay -->
          <div class="absolute inset-0 opacity-5 bg-[radial-gradient(circle_at_1px_1px,rgba(255,255,255,0.8)_1px,transparent_0)] bg-[length:10px_10px]"></div>
        </div>

        <!-- Modal Form -->
        <div class="p-6 overflow-y-auto max-h-[calc(100vh-12rem)]">
          <form [formGroup]="modalForm" (ngSubmit)="saveHomework()" class="space-y-5">

            <!-- Title Field -->
            <div class="relative">
              <label class="block text-sm font-semibold text-gray-900 dark:text-white mb-2 flex items-center gap-2">
                <div class="w-2 h-2 bg-gradient-to-r from-blue-500 to-indigo-600 rounded-full"></div>
                Title
              </label>
              <ion-input
                type="text"
                formControlName="title"
                placeholder="Enter homework title"
                class="custom-input w-full p-4 rounded-2xl bg-gradient-to-br from-white to-gray-50 dark:from-slate-700 dark:to-slate-600 border border-gray-200/80 dark:border-slate-600/80 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500/50 focus:border-blue-400 transition-all duration-300 shadow-sm hover:shadow-md"
                required>
              </ion-input>
              @if (modalForm.get('title')?.invalid && modalForm.get('title')?.touched) {
                <div class="text-red-500 text-xs font-medium mt-2 flex items-center gap-1 bg-red-50 dark:bg-red-900/20 px-3 py-1 rounded-lg">
                  <ion-icon name="warning" class="text-sm"></ion-icon>
                  Title is required (minimum 3 characters)
                </div>
              }
            </div>

            <!-- Description Field -->
            <div class="relative">
              <label class="block text-sm font-semibold text-gray-900 dark:text-white mb-2 flex items-center gap-2">
                <div class="w-2 h-2 bg-gradient-to-r from-green-500 to-emerald-600 rounded-full"></div>
                Description
              </label>
              <ion-textarea
                formControlName="description"
                placeholder="Enter homework description"
                class="custom-input w-full p-4 rounded-2xl bg-gradient-to-br from-white to-gray-50 dark:from-slate-700 dark:to-slate-600 border border-gray-200/80 dark:border-slate-600/80 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500/50 focus:border-blue-400 transition-all duration-300 shadow-sm hover:shadow-md"
                rows="3"
                [class.border-red-300]="modalForm.get('description')?.invalid && modalForm.get('description')?.touched"
                [class.focus:ring-red-500]="modalForm.get('description')?.invalid && modalForm.get('description')?.touched"
                required>
              </ion-textarea>
              @if (modalForm.get('description')?.invalid && modalForm.get('description')?.touched) {
                <div class="text-red-500 text-xs font-medium mt-2 flex items-center gap-1 bg-red-50 dark:bg-red-900/20 px-3 py-1 rounded-lg">
                  <ion-icon name="warning" class="text-sm"></ion-icon>
                  Description is required
                </div>
              }
            </div>

            <!-- Due Date Field -->
            <div class="relative">
              <label class="block text-sm font-semibold text-gray-900 dark:text-white mb-2 flex items-center gap-2">
                <div class="w-2 h-2 bg-gradient-to-r from-orange-500 to-red-600 rounded-full"></div>
                Due Date
              </label>
              @if (showDateTime) {
                <div class="relative">
                  <ion-datetime
                    presentation="date-time"
                    formControlName="dueDate"
                    class="w-full rounded-2xl bg-gradient-to-br from-white to-gray-50 dark:from-slate-700 dark:to-slate-600 border border-gray-200/80 dark:border-slate-600/80 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500/50 focus:border-blue-400 transition-all duration-300 shadow-sm"
                    [class.border-red-300]="modalForm.get('dueDate')?.invalid && modalForm.get('dueDate')?.touched"
                    [showDefaultTitle]="false"
                    [showDefaultButtons]="false"
                    [min]="today">
                  </ion-datetime>
                  <div class="absolute right-3 top-1/2 transform -translate-y-1/2 text-blue-500">
                    <!-- <ion-icon name="calendar" class="text-lg"></ion-icon> -->
                  </div>
                </div>
              }
              @if (modalForm.get('dueDate')?.invalid && modalForm.get('dueDate')?.touched) {
                <div class="text-red-500 text-xs font-medium mt-2 flex items-center gap-1 bg-red-50 dark:bg-red-900/20 px-3 py-1 rounded-lg">
                  <ion-icon name="warning" class="text-sm"></ion-icon>
                  Please select a due date
                </div>
              }
            </div>

            <!-- Class Selection Field -->
            <div class="relative">
              <label class="block text-sm font-semibold text-gray-900 dark:text-white mb-2 flex items-center gap-2">
                <div class="w-2 h-2 bg-gradient-to-r from-purple-500 to-pink-600 rounded-full"></div>
                Select Class
              </label>
              <ion-select
                placeholder="Choose class"
                formControlName="className"
                class="custom-input w-full rounded-2xl bg-gradient-to-br from-white to-gray-50 dark:from-slate-700 dark:to-slate-600 border border-gray-200/80 dark:border-slate-600/80 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500/50 focus:border-blue-400 transition-all duration-300 shadow-sm hover:shadow-md"
                interface="action-sheet"
                [class.border-red-300]="modalForm.get('className')?.invalid && modalForm.get('className')?.touched">
                @for (cls of classes; track cls.id) {
                  <ion-select-option [value]="cls.id">{{ cls.name }}</ion-select-option>
                }
              </ion-select>
              @if (modalForm.get('className')?.invalid && modalForm.get('className')?.touched) {
                <div class="text-red-500 text-xs font-medium mt-2 flex items-center gap-1 bg-red-50 dark:bg-red-900/20 px-3 py-1 rounded-lg">
                  <ion-icon name="warning" class="text-sm"></ion-icon>
                  Please select a class
                </div>
              }
            </div>

            <!-- Status Field -->
            <div class="relative">
              <label class="block text-sm font-semibold text-gray-900 dark:text-white mb-2 flex items-center gap-2">
                <div class="w-2 h-2 bg-gradient-to-r from-teal-500 to-cyan-600 rounded-full"></div>
                Status
              </label>
              <ion-select
                placeholder="Choose status"
                formControlName="status"
                class="custom-input w-full rounded-2xl bg-gradient-to-br from-white to-gray-50 dark:from-slate-700 dark:to-slate-600 border border-gray-200/80 dark:border-slate-600/80 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500/50 focus:border-blue-400 transition-all duration-300 shadow-sm hover:shadow-md"
                interface="action-sheet">
                <ion-select-option value="pending">Pending</ion-select-option>
                <ion-select-option value="completed">Completed</ion-select-option>
                <ion-select-option value="in-progress">In Progress</ion-select-option>
              </ion-select>
            </div>

            <!-- Modal Buttons -->
            <div class="flex gap-3 pt-6">
              <button
                type="submit"
                [disabled]="!modalForm.valid || isLoading"
                class="flex-1 bg-gradient-to-r from-emerald-500 via-green-500 to-teal-500 text-white font-bold py-4 px-6 rounded-2xl shadow-lg hover:shadow-xl transition-all duration-300 flex items-center justify-center gap-2 transform hover:scale-[1.02] active:scale-95 disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:scale-100 disabled:transform-none relative overflow-hidden group">

                <!-- Animated gradient overlay -->
                <div class="absolute inset-0 bg-gradient-to-r from-white/10 via-white/5 to-white/10 transform -skew-x-12 translate-x-[-100%] group-hover:translate-x-[100%] transition-transform duration-700"></div>

                @if (!isLoading) {
                  <div class="flex items-center justify-center gap-2 relative z-10">
                    <div class="w-5 h-5 bg-white/20 rounded-full flex items-center justify-center">
                      <ion-icon name="checkmark" class="text-sm text-white"></ion-icon>
                    </div>
                    <span class="drop-shadow-sm">{{ editingHomework ? 'Update' : 'Save' }}</span>
                  </div>
                }

                @if (isLoading) {
                  <div class="flex items-center justify-center gap-2 relative z-10">
                    <!-- Animated loading spinner -->
                    <div class="w-5 h-5 border-2 border-white/30 border-t-white rounded-full animate-spin"></div>
                    <span class="drop-shadow-sm">Saving...</span>
                  </div>
                }
              </button>

              <button
                type="button"
                (click)="closeModal()"
                class="flex-1 bg-gradient-to-r from-gray-300 via-gray-200 to-gray-300 dark:from-slate-600 dark:via-slate-500 dark:to-slate-600 text-gray-800 dark:text-white font-bold py-4 px-6 rounded-2xl shadow hover:shadow-md transition-all duration-200 flex items-center justify-center gap-2 transform hover:scale-[1.02] active:scale-95 relative overflow-hidden group">

                <!-- Animated overlay -->
                <div class="absolute inset-0 bg-gradient-to-r from-black/5 via-transparent to-black/5 transform -skew-x-12 translate-x-[-100%] group-hover:translate-x-[100%] transition-transform duration-700"></div>

                <div class="flex items-center justify-center gap-2 relative z-10">
                  <div class="w-5 h-5 bg-gray-500/20 dark:bg-gray-400/20 rounded-full flex items-center justify-center">
                    <ion-icon name="close" class="text-sm"></ion-icon>
                  </div>
                  <span class="drop-shadow-sm">Cancel</span>
                </div>
              </button>
            </div>

          </form>
        </div>
      </div>
    </div>
  </ng-template>
</ion-modal>
